

/* web/extensions/FSK/Selcall.min.js (web/extensions/FSK/Selcall.js = Mon May 30 07:12:07 2022) */
function Selcall(s,e){var n=this;console.log("FSK encoder: Selcall"),n.dbg=0,n.test_msgs=0,n.dump_non_std_len=1,n.dump_no_eos=0,n.start_bit=0,n.seq=0,n.MSG_LEN_MIN=30,n.MSG_LEN_MAX=80,n.synced=0,n.sym_s=["   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","RTN","   ","   ","   ","Pr0","Pr1","Pr2","Pr3","Pr4","Pr5","   ","   ","   ","   ","   ","   ","   ","ARQ","   ","   ","SEL","   ","ABQ","SMA","   ","Pdx","  *","EOS"],n.DX=125,n.RX5=109,n.FMT_GEO_AREA=102,n.FMT_DISTRESS=112,n.FMT_COMMON_INTEREST=114,n.FMT_ALL_SHIPS=116,n.FMT_INDIV_STA=120,n.FMT_RESV=121,n.FMT_IS_SEMI_AUTO=123,n.CAT_ROUTINE=100,n.CAT_SAFETY=108,n.CAT_URGENCY=110,n.CAT_DISTRESS=112,n.CMD1_FM_CALL=100,n.CMD1_FM_DUPLEX_CALL=101,n.CMD1_POLLING=103,n.CMD1_UNABLE_COMPLY=104,n.CMD1_END_OF_CALL=105,n.CMD1_F1B_DATA=106,n.CMD1_J3E_RT=109,n.CMD1_DISTRESS_ACK=110,n.CMD1_DISTRESS_ALERT_RELAY=112,n.CMD1_F1B_FEC=113,n.CMD1_F1B_ARQ=115,n.CMD1_TEST=118,n.CMD1_POSITION=121,n.CMD1_NOP=126,n.CMD2_UNABLE_FIRST=100,n.CMD2_BUSY=102,n.CMD2_UNABLE_LAST=109,n.CMD2_NON_CONFLICT=110,n.CMD2_MED_TRANSPORTS=111,n.CMD2_NOP=126,n.ARQ=117,n.ABQ=122,n.EOS=127,n.NOP=126,n.pos_s=["dx","rx5","dx","rx4","dx","rx3","dx","rx2","dx","rx1","dx","rx0","fmt","fmt","B1","fmt","B2","fmt","cat","B1","A1","B2","A2","cat","eos","A1","eos","A2","eos","eos"],n.pos={},n.pos_n={},n.pos_s.forEach(function(s,e){s=s.trim(),isDefined(n.pos_n[s])||(n.pos_n[s]=0),n.pos[s+"-"+n.pos_n[s].toString()]=e,n.pos_n[s]++}),n.dbg&&console.log(n.pos);var r=function(s){var e=kiwi_bitCount(127^s);return kiwi_bitReverse(e,3)};n.DX_w=r(n.DX)<<7|n.DX,n.svec=[];for(var _=n.RX5,o=0;o<12;o++)n.svec[o]=1&o?r(_)<<7|_:n.DX_w,1&o&&_--;n.dbg&&console.log(n.svec)}Selcall.prototype.sym_by_sym_name=function(s){var e=this.pos[s];return{pos:e,sym:this.syms[e]}},Selcall.prototype.output_msg=function(s){return(new Date).toUTCString().substr(17,8)+"Z "+(ext_get_freq()/1e3).toFixed(2)+" "+s+"\n"},Selcall.prototype.code_to_char=function(s){return s<0||s>127?"???":this.sym_s[s]},Selcall.prototype.reset=function(){var s=this;s.syncA=s.syncB=s.syncC=s.syncD=s.syncE=0},Selcall.prototype.get_nbits=function(){return 10},Selcall.prototype.get_msb=function(){return 512},Selcall.prototype.check_bits=function(){return!1},Selcall.prototype.search_sync=function(s){var e,n,r=this;e=s,n=1&r.syncA,r.syncA=r.syncA>>1&1023,r.syncA|=e?512:0,e=n,n=1&r.syncB,r.syncB=r.syncB>>1&1023,r.syncB|=e?512:0,e=n,n=1&r.syncC,r.syncC=r.syncC>>1&1023,r.syncC|=e?512:0,e=n,n=1&r.syncD,r.syncD=r.syncD>>1&1023,r.syncD|=e?512:0,e=n,n=1&r.syncE,r.syncE=r.syncE>>1&1023,r.syncE|=e?512:0;for(var _=0;_<=9;_++)if(r.syncC==r.svec[_]&&r.syncB==r.svec[_+1]&&r.syncA==r.svec[_+2])return console.log("SYNC-DRD-"+_),r.seq=_+3,r.full_syms=[],r.syms=[],r.bc_err=[],r.parity_errors=0,r.FEC_errors=0,r.synced=1,!0;for(_=1;_<=7;_+=2)if(r.syncE==r.svec[_]&&r.syncC==r.svec[_+2]&&r.syncA==r.svec[_+4])return console.log("SYNC-RRR-"+_),r.seq=_+5,r.full_syms=[],r.syms=[],r.bc_err=[],r.parity_errors=0,r.FEC_errors=0,r.synced=1,!0;return r.synced=0,!1},Selcall.prototype.process_char=function(s,e,n,r){var _=this;if(!_.synced)return{resync:0};_.full_syms[_.seq]=s;var o=s>>7&7,t=127&s;_.syms[_.seq]=t,A=(A=_.pos_s[_.seq])||"unk";var c=_.code_to_char(t),i=(u=(D=kiwi_bitReverse(o,3))!=(d=kiwi_bitCount(127^t)))?" Zck="+D+" Zdata="+d:"";_.bc_err[_.seq]=u,u&&_.parity_errors++,_.dbg&&console.log(_.seq.leadingZeros(2)+" "+A.fieldWidth(6)+": "+c+" "+t.fieldWidth(3)+". "+o.toString(2).leadingZeros(3)+" "+t.toString(2).leadingZeros(7)+i),_.seq++;var l=!1;if(_.seq>=_.MSG_LEN_MIN){var y=function(s){var e=0;return _.bc_err[_.seq-1]||_.syms[_.seq-1]!=s||e++,_.bc_err[_.seq-2]||_.syms[_.seq-2]!=s||e++,_.bc_err[_.seq-4]||_.syms[_.seq-4]!=s||e++,_.bc_err[_.seq-6]||_.syms[_.seq-6]!=s||e++,e>=3&&console.log("eos_n("+s+")="+e),e>=3},a=function(s,e){return s+e+ansi.NORM};if((y(_.EOS)||y(_.ARQ)||y(_.ABQ))&&(l=!0),l||_.seq>_.MSG_LEN_MAX){var S=0;if(l)_.seq!=_.MSG_LEN_MIN&&(r&&n(_.output_msg(a(ansi.BLUE,"non-std len="+_.seq))),console.log("$$ non-std len="+_.seq),S=_.dump_non_std_len);else{var u=_.parity_errors?" "+a(ansi.BLUE,_.parity_errors+" PE"):"";r&&n(_.output_msg(a(ansi.BLUE,"no EOS")+u)),console.log("$$ no EOS pe="+_.parity_errors),S=_.dump_no_eos}if(S&&dbgUs){for(var C=-1,E=0,p=(new Date).toUTCString().substr(17,8)+"Z ",M=0;M<_.seq;M++){s=_.full_syms[M];isUndefined(s)&&(s=119);var A,D,d;t=127&s;if(A=(A=_.pos_s[M])||"unk",!(1&M||M<12)){_.bc_err[M]&&M+5<_.seq&&(_.bc_err[M+5]?(t="FEC",!0):t=127&_.full_syms[M+5]);var f=t<=99?t.leadingZeros(2):t.toString();E!=f.length&&(C=(C+1)%ansi.rolling_n,a=ansi[ansi.rolling[C]],E=f.length),p+=a+f+ansi.NORM+" "}}n(p+"\n")}return _.synced=0,{resync:1}}}return{resync:0}};


