

/* web/extensions/FSK/Selcall.min.js (web/extensions/FSK/Selcall.js = Mon May 30 15:10:19 2022) */
function Selcall(s,e){var r=this;console.log("FSK encoder: Selcall"),r.dbg=0,r.test_msgs=0,r.dump_always=1,r.dump_non_std_len=1,r.dump_no_eos=0,r.zoom=10,r.start_bit=0,r.seq=0,r.MSG_LEN_MIN=30,r.MSG_LEN_MAX=80,r.synced=0,r.sym_s=["   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","   ","RTN","   ","   ","   ","Pr0","Pr1","Pr2","Pr3","Pr4","Pr5","   ","   ","   ","   ","   ","   ","   ","ARQ","   ","   ","SEL","   ","ABQ","SMA","   ","Pdx","  *","EOS"],r.DX=125,r.RX5=109,r.FMT_GEO_AREA=102,r.FMT_DISTRESS=112,r.FMT_COMMON_INTEREST=114,r.FMT_ALL_SHIPS=116,r.FMT_INDIV_STA=120,r.FMT_RESV=121,r.FMT_IS_SEMI_AUTO=123,r.CAT_ROUTINE=100,r.CAT_SAFETY=108,r.CAT_URGENCY=110,r.CAT_DISTRESS=112,r.CMD1_FM_CALL=100,r.CMD1_FM_DUPLEX_CALL=101,r.CMD1_POLLING=103,r.CMD1_UNABLE_COMPLY=104,r.CMD1_END_OF_CALL=105,r.CMD1_F1B_DATA=106,r.CMD1_J3E_RT=109,r.CMD1_DISTRESS_ACK=110,r.CMD1_DISTRESS_ALERT_RELAY=112,r.CMD1_F1B_FEC=113,r.CMD1_F1B_ARQ=115,r.CMD1_TEST=118,r.CMD1_POSITION=121,r.CMD1_NOP=126,r.CMD2_UNABLE_FIRST=100,r.CMD2_BUSY=102,r.CMD2_UNABLE_LAST=109,r.CMD2_NON_CONFLICT=110,r.CMD2_MED_TRANSPORTS=111,r.CMD2_NOP=126,r.ARQ=117,r.ABQ=122,r.EOS=127,r.NOP=126,r.pos_s=["dx","rx5","dx","rx4","dx","rx3","dx","rx2","dx","rx1","dx","rx0","fmt","fmt","B1","fmt","B2","fmt","cat","B1","A1","B2","A2","cat","eos","A1","eos","A2","eos","eos"],r.pos={},r.pos_n={},r.pos_s.forEach(function(s,e){s=s.trim(),isDefined(r.pos_n[s])||(r.pos_n[s]=0),r.pos[s+"-"+r.pos_n[s].toString()]=e,r.pos_n[s]++}),r.dbg&&console.log(r.pos);var n=function(s){var e=kiwi_bitCount(127^s);return kiwi_bitReverse(e,3)};r.DX_w=n(r.DX)<<7|r.DX,r.svec=[];for(var _=r.RX5,o=0;o<12;o++)r.svec[o]=1&o?n(_)<<7|_:r.DX_w,1&o&&_--;r.dbg&&console.log(r.svec)}Selcall.prototype.sym_by_sym_name=function(s){var e=this.pos[s];return{pos:e,sym:this.syms[e]}},Selcall.prototype.output_msg=function(s){return(new Date).toUTCString().substr(17,8)+"Z "+(ext_get_freq()/1e3).toFixed(2)+" "+s+"\n"},Selcall.prototype.code_to_char=function(s){return s<0||s>127?"???":this.sym_s[s]},Selcall.prototype.reset=function(){var s=this;s.syncA=s.syncB=s.syncC=s.syncD=s.syncE=0},Selcall.prototype.get_nbits=function(){return 10},Selcall.prototype.get_msb=function(){return 512},Selcall.prototype.check_bits=function(){return!1},Selcall.prototype.search_sync=function(s){var e,r,n=this;e=s,r=1&n.syncA,n.syncA=n.syncA>>1&1023,n.syncA|=e?512:0,e=r,r=1&n.syncB,n.syncB=n.syncB>>1&1023,n.syncB|=e?512:0,e=r,r=1&n.syncC,n.syncC=n.syncC>>1&1023,n.syncC|=e?512:0,e=r,r=1&n.syncD,n.syncD=n.syncD>>1&1023,n.syncD|=e?512:0,e=r,r=1&n.syncE,n.syncE=n.syncE>>1&1023,n.syncE|=e?512:0;for(var _=0;_<=9;_++)if(n.syncC==n.svec[_]&&n.syncB==n.svec[_+1]&&n.syncA==n.svec[_+2])return console.log("SYNC-DRD-"+_),n.seq=_+3,n.full_syms=[],n.syms=[],n.bc_err=[],n.parity_errors=0,n.FEC_errors=0,n.synced=1,!0;for(_=1;_<=7;_+=2)if(n.syncE==n.svec[_]&&n.syncC==n.svec[_+2]&&n.syncA==n.svec[_+4])return console.log("SYNC-RRR-"+_),n.seq=_+5,n.full_syms=[],n.syms=[],n.bc_err=[],n.parity_errors=0,n.FEC_errors=0,n.synced=1,!0;return n.synced=0,!1},Selcall.prototype.process_char=function(s,e,r,n){var _=this;if(!_.synced)return{resync:0};if(_.test){var o=kiwi_bitReverse(kiwi_bitCount(127^c),3)<<7;c|=o}_.full_syms[_.seq]=s;var t=s>>7&7,i=127&s;_.syms[_.seq]=i,v=(v=_.pos_s[_.seq])||"unk";var l=_.code_to_char(i),y=(f=(o=kiwi_bitReverse(t,3))!=(T=kiwi_bitCount(127^i)))?" Zck="+o+" Zdata="+T:"";_.bc_err[_.seq]=f,f&&_.parity_errors++,_.dbg&&console.log(_.seq.leadingZeros(2)+" "+v.fieldWidth(6)+": "+l+" "+i.fieldWidth(3)+". "+t.toString(2).leadingZeros(3)+" "+i.toString(2).leadingZeros(7)+y),_.seq++;var a=!1;if(_.seq>=_.MSG_LEN_MIN){var u=function(s){var e=0;return _.bc_err[_.seq-1]||_.syms[_.seq-1]!=s||e++,_.bc_err[_.seq-2]||_.syms[_.seq-2]!=s||e++,_.bc_err[_.seq-4]||_.syms[_.seq-4]!=s||e++,_.bc_err[_.seq-6]||_.syms[_.seq-6]!=s||e++,e>=3&&console.log("eos_n("+s+")="+e),e>=3},S=function(s,e){return s+e+ansi.NORM},p=function(s,e,r){return w3_link("w3-esc-html w3-link-darker-color","www.marinetraffic.com/en/ais/home/centerx:"+r+"/centery:"+e+"/zoom:"+_.zoom,s)};if((u(_.EOS)||u(_.ARQ)||u(_.ABQ))&&(a=!0),a||_.seq>_.MSG_LEN_MAX){var C=_.dump_always;if(a)_.seq!=_.MSG_LEN_MIN&&(n&&r(_.output_msg(S(ansi.BLUE,"non-std len="+_.seq))),console.log("$$ non-std len="+_.seq),C|=_.dump_non_std_len);else{var f=_.parity_errors?" "+S(ansi.BLUE,_.parity_errors+" PE"):"";n&&r(_.output_msg(S(ansi.BLUE,"no EOS")+f)),console.log("$$ no EOS pe="+_.parity_errors),C|=_.dump_no_eos}if(C){for(var E=!1,M=-1,d=0,m=[],A=(new Date).toUTCString().substr(17,8)+"Z ",D=0;D<_.seq;D++){s=_.full_syms[D];isUndefined(s)&&(s=119);var v,T;i=127&s;if(v=(v=_.pos_s[D])||"unk",!(1&D||D<12)){_.bc_err[D]&&D+5<_.seq&&(_.bc_err[D+5]?(i="FEC",E=!0):i=127&_.full_syms[D+5]),14==D&&(127&_.full_syms[18])>99&&(m.push("  "),A+="   "),20==D&&(127&_.full_syms[24])>99&&(m.push("  "),A+="   ");var g=i<=99?i.leadingZeros(2):i.toString();d!=g.length&&(M=(M+1)%ansi.rolling_n,S=ansi[ansi.rolling[M]],d=g.length),A+=S+g+ansi.NORM+" ",m.push(g)}}if(!E){var N=0;if(121==+m[8]&&(N=10),N){var R="";for(D=0;D<=6;D++)R+=m[N+D];var L=R.slice(1,3)+"."+R.slice(3,5),b=R.slice(5,8)+"."+R.slice(8,10);A+=p("["+L+","+b+"]",+L,+b)+" ",A+=p("[-lat]",-L,+b)+" ";var q=R.slice(1,3)+"°"+R.slice(3,5)+"'",F=R.slice(5,8)+"°"+R.slice(8,10)+"'",B=R.slice(1,3)+(+R.slice(3,5)/60).toFixed(2).slice(1),O=R.slice(5,8)+(+R.slice(8,10)/60).toFixed(2).slice(1);A+=p("["+q+","+F+"]",+B,+O)+" ",A+=p("[-lat]",-B,+O)+" ",A+=R.slice(10,12)+":"+R.slice(12,14)+"Z"}}r(A+"\n")}return _.synced=0,{resync:1}}}return{resync:0}};


